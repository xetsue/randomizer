<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xsu Randomizer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: monospace, monospace;
            color: #f0f0f0;
            -webkit-tap-highlight-color: transparent;
        }

        #main-randomizer-area {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 15px;
        }

        #slot-container {
            position: relative;
            width: 80vmin;
            min-height: 20vmin;
            background-color: #050505;
            border: 1px solid #f0f0f0;
            border-radius: 5px;
            display: flex;
            text-alighn: justify;
            align-items: left;
            justify-content: center;
            cursor: pointer;
            box-sizing: border-box;
            overflow: hidden;
            padding: 10px;
        }

        #empty-slot-text {
            color: #333;
            font-size: 2em;
            text-align: center;
            position: absolute;
            z-index: 1;
            padding: 10px;
        }

        #slot-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            width: 95%;
            min-height: 80%;
            overflow: hidden;
            background-color: #1a1a1a;
            border: 1px inset #555;
            padding: 5px;
            box-sizing: border-box;
            color: #f0f0f0;
            text-shadow: 0 0 5px #f0f0f0;
            line-height: 1.2;
        }

        .slot-char-container {
            display: inline-flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            font-size: 3vmin;
            line-height: 1.2;
            white-space: pre;
            text-align: center;
            padding: 0 0.2vmin;
        }

        .slot-char-current {
            position: static;
            width: auto;
        }

        @keyframes glitch-effect {
            0% {
                transform: translate(0);
                filter: hue-rotate(0deg);
                opacity: 1;
            }
            20% {
                transform: translate(-2px, 2px);
                filter: hue-rotate(90deg);
                opacity: 0.9;
            }
            40% {
                transform: translate(2px, -2px);
                filter: hue-rotate(180deg);
                opacity: 1;
            }
            60% {
                transform: translate(-1px, 1px);
                filter: hue-rotate(270deg);
                opacity: 0.8;
            }
            80% {
                transform: translate(1px, -1px);
                filter: hue-rotate(360deg);
                opacity: 1;
            }
            100% {
                transform: translate(0);
                filter: hue-rotate(0deg);
                opacity: 1;
            }
        }

        .glitching .slot-char-current {
            animation: glitch-effect 0.1s infinite alternate;
        }

        #list-history-panel {
            width: 80vmin;
            background-color: #050505ee;
            border: 1px solid #f0f0f0;
            border-radius: 5px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            min-height: 30vh;
            max-height: 50vh;
            margin-top: 35px; 
            display: flex;
        }

        #list-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            position: sticky;
            top: 0;
            background-color: #050505ee;
            z-index: 2;
        }

        #panel-toggle-button {
            background-color: transparent;
            border: none;
            color: #f0f0f0;
            font-size: 1.2em;
            cursor: pointer;
            font-family: monospace, monospace;
        }

        #panel-action-buttons {
            display: flex;
            gap: 5px;
        }

        .panel-button {
            padding: 5px 10px;
            background-color: transparent;
            border: 1px solid #f0f0f0;
            color: #f0f0f0;
            cursor: pointer;
            border-radius: 30px;
            font-family: monospace, monospace;
            font-size: 0.9em;
        }

        #panel-content-wrapper {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            position: relative;
        }

        #list-view-textarea {
            width: 100%;
            height: 100%;
            min-height: 100px;
            padding: 0;
            background-color: transparent;
            color: #f0f0f0;
            border: none;
            outline: none;
            resize: none;
            font-family: monospace, monospace;
            box-sizing: border-box;
            padding-bottom: 35px;
        }

        #start-button-in-textarea {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: transparent;
            border: 1px solid #f0f0f0;
            color: #f0f0f0;
            cursor: pointer;
            border-radius: 30px;
            font-family: monospace, monospace;
            font-size: 0.9em;
            z-index: 10;
        }

        #history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #history-list li {
            padding: 5px 0;
            border-bottom: 1px dashed #555;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }

        #history-list li:last-child {
            border-bottom: none;
        }

        .history-timestamp {
            font-size: 0.8em;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div id="main-randomizer-area">
        <div id="slot-container">
            <div id="empty-slot-text"></div>
            <div id="slot-display"></div>
        </div>

        <div id="list-history-panel">
            <div id="list-history-header">
                <button id="panel-toggle-button">List ▼</button>
                <div id="panel-action-buttons">
                </div>
            </div>
            <div id="panel-content-wrapper">
            </div>
        </div>
    </div>
    <p id="disappearingText" style="font-size: 10px; font-color: #333333;">[ Histories are saved on your device only ]</p>
	<footer style="text-align: center; margin-top: 20px; color: #555; padding: 10px;">
        <a href="https://xetsue.github.io/" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">xetsue.github.io</a>
    </footer>
	<script>
	  setTimeout(function() {
	    document.getElementById('disappearingText').style.display = 'none';
	  }, 3000); // milliseconds = 3 seconds
	  
        const slotContainer = document.getElementById('slot-container');
        const emptySlotText = document.getElementById('empty-slot-text');
        const slotDisplay = document.getElementById('slot-display');

        const listHistoryPanel = document.getElementById('list-history-panel');
        const panelToggleButton = document.getElementById('panel-toggle-button');
        const panelActionButtons = document.getElementById('panel-action-buttons');
        const panelContentWrapper = document.getElementById('panel-content-wrapper');

        let items = [];
        let history = [];
        let currentResult = null;
        let isAnimating = false;
        let currentPanelMode = 'list';

        const glitchChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_+=[]{}|;:',.<>/?`~";
        const scrambleInterval = 50;
        const stopDelayPerChar = 100;
        const totalScrambleTime = 2000;

        const interestingFacts = [
            "The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes.",
            "A group of owls is called a parliament.",
            "Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly edible.",
            "The human brain weighs about 3 pounds but uses 20% of the body's oxygen and calories.",
            "There are more possible iterations of a game of chess than there are atoms in the observable universe.",
            "A single cloud can weigh more than 1 million pounds.",
            "It is impossible for most people to lick their own elbow.",
            "The 'sixth sick sheik's sixth sheep's sick' is believed to be the toughest tongue twister in the English language.",
            "Polar bears have black skin under their white fur.",
            "A shrimp's heart is in its head.",
            "Octopuses have three hearts.",
            "The average person walks the equivalent of three times around the world in their lifetime.",
            "Bananas are berries, but strawberries aren't.",
            "The Great Wall of China is not visible from space with the naked eye.",
            "Sharks have been around for more than 400 million years, predating trees.",
            "The loudest sound ever recorded was the 1883 eruption of Krakatoa, heard 3,000 miles away.",
            "Cows moo in regional accents.",
            "It takes about 8 minutes, 20 seconds for sunlight to reach Earth.",
            "Butterflies taste with their feet.",
            "A bolt of lightning is five times hotter than the surface of the sun."
        ];

        function saveState() {
            localStorage.setItem('xsuRandomizerItems', JSON.stringify(items));
            localStorage.setItem('xsuRandomizerHistory', JSON.stringify(history));
        }

        function loadState() {
            const savedItems = localStorage.getItem('xsuRandomizerItems');
            const savedHistory = localStorage.getItem('xsuRandomizerHistory');
            if (savedItems) {
                items = JSON.parse(savedItems);
            }
            if (savedHistory) {
                history = JSON.parse(savedHistory);
            }
        }

        function renderSlotDisplay(displayContent) {
            slotDisplay.innerHTML = '';
            emptySlotText.style.display = 'none';

            for (let char of displayContent) {
                const charContainer = document.createElement('div');
                charContainer.classList.add('slot-char-container');
                const charSpan = document.createElement('span');
                charSpan.classList.add('slot-char-current');
                charSpan.textContent = char;
                charContainer.appendChild(charSpan);
                slotDisplay.appendChild(charContainer);
            }

            if (items.length === 0 && displayContent === "BY TSU.") {
                emptySlotText.style.display = 'block';
                slotContainer.style.border = 'none';
            } else {
                slotContainer.style.border = '1px solid #f0f0f0';
            }
        }

        function renderPanel() {
            panelActionButtons.innerHTML = '';
            panelContentWrapper.innerHTML = '';

            if (currentPanelMode === 'list') {
                panelToggleButton.textContent = 'List ▼';

                const resetBtn = document.createElement('button');
                resetBtn.id = 'reset-button';
                resetBtn.classList.add('panel-button');
                resetBtn.textContent = 'Reset';
                resetBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    resetAllData();
                });
                panelActionButtons.appendChild(resetBtn);

                const flipBtn = document.createElement('button');
                flipBtn.id = 'flip-button';
                flipBtn.classList.add('panel-button');
                flipBtn.textContent = 'Flip';
                flipBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    startFlipAnimation();
                });
                panelActionButtons.appendChild(flipBtn);

                const textarea = document.createElement('textarea');
                textarea.id = 'list-view-textarea';
                textarea.value = items.join('\n');
                textarea.placeholder = "Tap Anywhere To Start \nEnter items, one per line...\n\n1\n\n2\n\n3\n\n4\n\n5";
                panelContentWrapper.appendChild(textarea);

                const startButtonInTextarea = document.createElement('button');
                startButtonInTextarea.id = 'start-button-in-textarea';
                startButtonInTextarea.textContent = 'Start';
                startButtonInTextarea.addEventListener('click', (event) => {
                    event.stopPropagation();
                    saveListFromTextarea();
                    startRandomCharacterAnimation();
                });
                panelContentWrapper.appendChild(startButtonInTextarea);

            } else {
                panelToggleButton.textContent = 'History ▼';

                const removeBtn = document.createElement('button');
                removeBtn.id = 'remove-button';
                removeBtn.classList.add('panel-button');
                removeBtn.textContent = 'Remove Last';
                removeBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    removeItemFromHistory();
                });
                if (!currentResult || history.length === 0) removeBtn.disabled = true;
                panelActionButtons.appendChild(removeBtn);

                const editBtn = document.createElement('button');
                editBtn.id = 'edit-button';
                editBtn.classList.add('panel-button');
                editBtn.textContent = 'Edit';
                editBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    currentPanelMode = 'list';
                    renderPanel();
                });
                panelActionButtons.appendChild(editBtn);

                const ul = document.createElement('ul');
                ul.id = 'history-list';
                history.forEach(entry => {
                    const li = document.createElement('li');
                    const textSpan = document.createElement('span');
                    textSpan.textContent = entry.item;
                    const timestampSpan = document.createElement('span');
                    timestampSpan.classList.add('history-timestamp');
                    timestampSpan.textContent = new Date(entry.timestamp).toLocaleString();
                    li.appendChild(textSpan);
                    li.appendChild(timestampSpan);
                    ul.prepend(li);
                });
                panelContentWrapper.appendChild(ul);
            }
        }

        function saveListFromTextarea() {
            const textarea = document.getElementById('list-view-textarea');
            if (textarea) {
                const newItems = textarea.value.split('\n').map(item => item.trim()).filter(item => item !== '');
                items = newItems;
                saveState();
                if (items.length > 0) {
                    renderSlotDisplay(items[0]);
                } else {
                    renderSlotDisplay("BY TSU.");
                }
            }
        }

        function removeItemFromHistory() {
            if (history.length === 0) {
                alert('History is empty. Nothing to remove.');
                return;
            }

            const lastHistoryItem = history[history.length - 1].item;

            if (confirm(`Are you sure you want to remove the last entry "${lastHistoryItem}" from history?`)) {
                history.pop();
                saveState();
                renderPanel();

                currentResult = history.length > 0 ? history[history.length - 1].item : null;

                if (items.length > 0) {
                    renderSlotDisplay(items[0]);
                } else {
                    renderSlotDisplay("BY TSU.");
                }
            }
        }

        function resetAllData() {
            if (confirm('Are you sure you want to reset ALL data? This will clear your list and all history.')) {
                items = [];
                history = [];
                localStorage.clear();
                renderSlotDisplay("BY TSU.");
                currentResult = null;
                currentPanelMode = 'list';
                renderPanel();
                alert('All data has been reset.');
            }
        }

        async function startRandomCharacterAnimation(forceFact = false) {
            let itemToDisplay;
            let fromList = true;

            if (items.length === 0 || forceFact) {
                itemToDisplay = interestingFacts[Math.floor(Math.random() * interestingFacts.length)];
                fromList = false;
            } else {
                const randomIndex = Math.floor(Math.random() * items.length);
                itemToDisplay = items[randomIndex];
                fromList = true;
            }

            if (isAnimating) return;

            isAnimating = true;
            slotContainer.style.cursor = 'not-allowed';
            panelActionButtons.style.pointerEvents = 'none';

            renderSlotDisplay(itemToDisplay);
            const charContainers = Array.from(slotDisplay.children);

            const scrambleIntervals = [];
            charContainers.forEach((container) => {
                const charSpan = container.querySelector('.slot-char-current');
                charSpan.classList.add('glitching');

                const interval = setInterval(() => {
                    charSpan.textContent = glitchChars[Math.floor(Math.random() * glitchChars.length)];
                }, scrambleInterval);
                scrambleIntervals.push(interval);
            });

            await new Promise(resolve => setTimeout(resolve, totalScrambleTime));

            for (let i = charContainers.length - 1; i >= 0; i--) {
                clearInterval(scrambleIntervals[i]);
                const charSpan = charContainers[i].querySelector('.slot-char-current');
                charSpan.classList.remove('glitching');
                charSpan.textContent = itemToDisplay[i] || ' ';
                await new Promise(resolve => setTimeout(resolve, stopDelayPerChar));
            }

            if (fromList) {
                history.push({ item: itemToDisplay, timestamp: new Date().toISOString() });
                saveState();
                currentPanelMode = 'history';
            } else {
                currentPanelMode = currentPanelMode;
            }
            currentResult = itemToDisplay;
            renderPanel();
            isAnimating = false;
            slotContainer.style.cursor = 'pointer';
            panelActionButtons.style.pointerEvents = 'auto';
        }

        async function startFlipAnimation() {
            if (isAnimating) return;

            isAnimating = true;
            slotContainer.style.cursor = 'not-allowed';
            panelActionButtons.style.pointerEvents = 'none';

            let result;
            const randomNumber = Math.random();
            if (randomNumber < 0.01) {
                result = "Middle";
            } else if (randomNumber < 0.505) {
                result = "Heads";
            } else {
                result = "Tails";
            }

            renderSlotDisplay(result);
            const charContainers = Array.from(slotDisplay.children);

            const scrambleIntervals = [];
            charContainers.forEach((container) => {
                const charSpan = container.querySelector('.slot-char-current');
                charSpan.classList.add('glitching');

                const interval = setInterval(() => {
                    charSpan.textContent = glitchChars[Math.floor(Math.random() * glitchChars.length)];
                }, scrambleInterval);
                scrambleIntervals.push(interval);
            });

            await new Promise(resolve => setTimeout(resolve, totalScrambleTime));

            for (let i = charContainers.length - 1; i >= 0; i--) {
                clearInterval(scrambleIntervals[i]);
                const charSpan = charContainers[i].querySelector('.slot-char-current');
                charSpan.classList.remove('glitching');
                charSpan.textContent = result[i] || ' ';
                await new Promise(resolve => setTimeout(resolve, stopDelayPerChar));
            }

            currentResult = result;
            renderPanel();
            isAnimating = false;
            slotContainer.style.cursor = 'pointer';
            panelActionButtons.style.pointerEvents = 'auto';
        }

        slotContainer.addEventListener('click', startRandomCharacterAnimation);

        panelToggleButton.addEventListener('click', (event) => {
            event.stopPropagation();
            currentPanelMode = currentPanelMode === 'list' ? 'history' : 'list';
            renderPanel();
        });

        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space' && !isAnimating) {
                event.preventDefault();
                startRandomCharacterAnimation();
            }
        });

        document.body.addEventListener('click', (event) => {
            const clickedInsideSlot = slotContainer.contains(event.target);
            const clickedInsidePanel = listHistoryPanel.contains(event.target);

            if (!clickedInsideSlot && !clickedInsidePanel && !isAnimating) {
                if (currentPanelMode === 'list') {
                    saveListFromTextarea();
                }
                startRandomCharacterAnimation();
            }
        });

        loadState();
        if (items.length === 0) {
            renderSlotDisplay("Xsu.");
            currentPanelMode = 'list';
        } else {
            renderSlotDisplay(items[0]);
        }
        renderPanel();
    </script>
</body>
</html>
